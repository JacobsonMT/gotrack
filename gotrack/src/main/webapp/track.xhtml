<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">
<f:metadata>
	<f:viewParam id="currentSpecies" name="currentSpecies"
		value="#{trackView.currentSpecies}" />
	<f:viewParam id="query" name="query" value="#{trackView.query}" />
	<f:event type="preRenderView" listener="#{trackView.init}" />
</f:metadata>
<h:head>
	<title>UBC-CHiBi|GOtrack</title>
	<h:outputStylesheet library="css" name="style.css" />
	<h:outputStylesheet library="css" name="styles3.css" />
	<h:outputStylesheet library="css" name="custom.css" />

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- Prevents caching at the Proxy Server -->

	<meta http-equiv="Expires" content="0" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description"
		content="GOtrack is an integral tool that reflects the problems and trends in the stability and annotation biases of multiple model organisms." />

	<meta name="keywords"
		content="genomics,bioinformatics,genetics,gene,function,ontology,biotechnology,medicine,biomedical,meta-analysis,statistics,search,open source,database,software" />
	<meta name="author" content="GOtrack admin (asedeno@chibi.ubc.ca)" />
	<h:outputScript library="js" name="lineHighlighter.js" />
	<h:outputScript library="js" name="gotrack.js" />
	<script>
      function chartExtender() {
         // this = chart widget instance        
         // this.cfg = options 
         this.cfg.legend = {
            renderer : $.jqplot.EnhancedLegendRenderer,
            show : true,
            location : 'ne',
            placement : 'outsideGrid',
            rendererOptions : {
               numberRows : 0
            }
         }
         this.cfg.highlighter = {
            show : true,
            tooltipLocation : 'sw',
            useAxesFormatters : true,
            tooltipAxes : 'xy',
            yvalues : 1,
            formatString : 'Date: %s ~ Count: %s',
            tooltipContentEditor : function(str, seriesIndex, pointIndex, plot) {
               return plot.series[seriesIndex].label + ": " + str;
            },
            bringSeriesToFront : true

         }
      }
   </script>
</h:head>

<h:body>
	<div id="site-wrapper">
		<div id="header">
			<div id="top">
				<div class="left" id="logo">
					<h:graphicImage library="img" width="130" height="110"
						name="logo1.png" />
				</div>
				<div class="left navigation" id="main-nav">
					<ul class="tabbed">
						<li class="current-tab"><h:link value="Home"
								outcome="index.xhtml" /></li>
						<li><h:link value="Browse Global trends"
								outcome="trends.xhtml" /></li>
						<li><h:link value="Tutorial" outcome="about.xhtml" /></li>
						<li><h:link value="Documentation"
								outcome="documentation.xhtml" /></li>

						<li><h:link value="Resources" outcome="resources.xhtml" /></li>
					</ul>
					<div class="clearer">&nbsp;</div>
				</div>
				<div class="clearer">&nbsp;</div>
			</div>
		</div>


		<!-- This is the delimiter for the menu nav bar, not implementing the sub-nav -->

		<!-- Beginning of the two main columns -->
		<div class="main" id="main-two-columns">
			<!-- MAIN -->
			<div id="page-title">
				<h1>Count History</h1>
			</div>

			<div class="section">
				<div class="section-title">

					<h:form>
					Displaying results for: #{trackView.query}
					<p:commandButton style="font-size: 7px;" icon="ui-icon-info"
							id="tooltipe" />
						<p:tooltip id="uniprots" for="tooltipe">
							<h:panelGroup>
								<h:outputText
									value="A gene symbol can be associated to multiple Uniprot IDs" />
								<br />
								<h:outputText
									value="that are simultaneously annotated in the GOA files. One" />
								<br />
								<h:outputText
									value="of those IDs corresponds to a manually reviewed SwissProt Id," />
								<br />
								<h:outputText
									value="and the others correspond to unreviewed TrEMBL Ids. All the" />
								<br />
								<h:outputText
									value="Uniprot Ids that matched the symbol will be displayed." />
							</h:panelGroup>
						</p:tooltip>
					</h:form>
				</div>

				<div class="post">
					<div class="post-body">
						<h:form>
							<p:dialog id="dlg2" header="Annotations" widgetVar="dlg2"
								modal="false" width="600px">
								<h:outputText id="dialogMsg"
									value="Date: #{trackView.selectedDate}, Count: #{fn:length(trackView.terms)}" />
								    <p:dataTable id="dialogAnnotations" widgetVar="annotationsTable" var="term" value="#{trackView.terms}" scrollable="true" scrollHeight="250" sortMode="multiple" style="margin-bottom:0" emptyMessage="No annotations found with given criteria" filteredValue="#{trackView.filteredTerms}">
								        <p:column filterBy="#{term.goId}" filterMatchMode="contains" headerText="Id" style="width:120px;">
								            <h:outputText value="#{term.goId}" />
								        </p:column>
								        <p:column filterBy="#{term.aspect}" filterMatchMode="in" headerText="Aspect" style="width:100px;">
								            <f:facet name="filter">
								                <p:selectCheckboxMenu label="Aspect" onchange="PF('annotationsTable').filter()" panelStyle="width:125px" scrollHeight="150" panelStyleClass="without-selectall">
								                    <f:selectItems value="#{trackView.aspects}" />
								                </p:selectCheckboxMenu>
								            </f:facet>
								            <h:outputText value="#{term.aspect}" />
								        </p:column>
								        <p:column filterBy="#{term.name}" filterMatchMode="contains" headerText="Name">
								            <h:outputText value="#{term.name}" />
								        </p:column>
								    </p:dataTable>
							</p:dialog>
							<p:growl id="growl" showDetail="true" />
							<div id="">
							<p:outputPanel id="allCharts" deferred="true">
								<p:chart id='chart1' type="line"
									model="#{trackView.currentChart}" style="height:500px;"
									widgetVar="chart" rendered="#{trackView.chartsReady}">
									<p:ajax event="itemSelect" listener="#{trackView.itemSelect}"
										onsuccess="PF('dlg2').show();"
										update="dialogMsg,dialogAnnotations" />
								</p:chart>
								<div class="ui-grid ui-grid-responsive">
									<div class="ui-grid-row">
										<div class="ui-grid-col-2">
											<p:commandButton type="button" value="Reset"
												icon="ui-icon-cancel" onclick="PF('chart').resetZoom()" rendered="#{trackView.chartsReady}"/>
										</div>
										<div class="ui-grid-col-3">
											<p:selectOneButton value="#{trackView.graphType}" rendered="#{trackView.chartsReady}">
												<p:ajax listener="#{trackView.changeGraph}" update="chart1" />
												<f:selectItems value="#{trackView.graphs}" var="gr"
													itemLabel="#{gr}" itemValue="#{gr}" />
											</p:selectOneButton>
										</div>
										<div class="ui-grid-col-2">
											<p:selectBooleanButton value="#{trackView.splitAccessions}" onLabel="Combined" offLabel="Split" rendered="#{trackView.chartsReady}">
											<p:ajax listener="#{trackView.changeGraph}" update="chart1" />
											</p:selectBooleanButton>
										</div>
									</div>
								</div>
							</p:outputPanel>
							</div>
							<p:remoteCommand name="fetchCharts"                          
							                  actionListener="#{trackView.fetchCharts}" update="allCharts" oncomplete="updateCharts()">
							 </p:remoteCommand>
							<p:remoteCommand name="updateCharts"  update="allCharts">
							 </p:remoteCommand>


							<!-- PUT THE ACTUAL CONTENT -->

							<!-- End of the FUNCTIONALITY CONTENT -->
						</h:form>

					</div>
				</div>
			</div>
			<div class="content-separator"></div>


			<div class="clearer">&nbsp;</div>
			<!-- MAIN -->
		</div>
	</div>

	<!-- This is the end of the two main columns -->

	<div id="footer">
		<div class="center" id="footer-left">
			<p>
				&copy; UBC, Centre of High-throughput Biology, 2014 <a
					href="terms.xhtml">Terms and Conditions</a>
			</p>
		</div>
	</div>
</h:body>
</html>

