<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	>
<f:metadata>
	<f:viewParam id="currentSpeciesId" name="currentSpeciesId"
		value="#{trackView.currentSpeciesId}" />
	<f:viewParam id="query" name="query" value="#{trackView.query}" />
	<f:event type="preRenderView" listener="#{trackView.init}" />
</f:metadata>
<h:head>
	<title>UBC-CHiBi|GOtrack</title>
	<h:outputStylesheet name="webjars/font-awesome/4.2.0/css/font-awesome.css" />
	<h:outputStylesheet library="css" name="style.css" />
	<h:outputStylesheet library="css" name="styles3.css" />
	<h:outputStylesheet library="css" name="custom.css" />

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- Prevents caching at the Proxy Server -->

	<meta http-equiv="Expires" content="0" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description"
		content="GOtrack is an integral tool that reflects the problems and trends in the stability and annotation biases of multiple model organisms." />

	<meta name="keywords"
		content="genomics,bioinformatics,genetics,gene,function,ontology,biotechnology,medicine,biomedical,meta-analysis,statistics,search,open source,database,software" />
	<meta name="author" content="GOtrack admin (asedeno@chibi.ubc.ca)" />
	<!-- <h:outputScript library="js" name="lineHighlighter.js" /> -->
	<h:outputScript library="js" name="gotrack.js" />
	<script>
      function chartExtender() {
         // this = chart widget instance        
         // this.cfg = options 
         this.cfg.legend = {
            renderer : $.jqplot.EnhancedLegendRenderer,
            show : true,
            location : 'ne',
            placement : 'outsideGrid',
            rendererOptions : {
               numberRows : 0,
               seriesToggle: true,
               seriesToggleReplot : {resetAxes: true}
            }
         }
         this.cfg.highlighter = {
            show : true,
            tooltipLocation : 'sw',
            useAxesFormatters : true,
            tooltipAxes : 'xy',
            yvalues : 1,
            formatString : 'Date: %s ~ Count: %s',
            tooltipContentEditor : function(str, seriesIndex, pointIndex, plot) {
               return plot.series[seriesIndex].label + ": " + str;
            },
            bringSeriesToFront : true

         }
         //console.log(this.cfg.axes);
         //this.cfg.axes.yaxis.label = "Per Capita Expenditure (local currency)";
         //this.cfg.axes.yaxis.renderer = $.jqplot.LogAxisRenderer;

         //this.cfg.axes.yaxis.ticks = [1,100];
      }
   </script>
</h:head>

<h:body>
	<div id="site-wrapper">
		<div id="header">
			<div id="top">
				<div class="left" id="logo">
					<h:graphicImage library="img" width="130" height="110"
						name="logo1.png" />
				</div>
				<div class="left navigation" id="main-nav">
					<ul class="tabbed">
						<li class="current-tab"><h:link value="Home"
								outcome="index.xhtml" /></li>
						<li><h:link value="Browse Global trends"
								outcome="trends.xhtml" /></li>
						<li><h:link value="Tutorial" outcome="about.xhtml" /></li>
						<li><h:link value="Documentation"
								outcome="documentation.xhtml" /></li>

						<li><h:link value="Resources" outcome="resources.xhtml" /></li>
					</ul>
					<div class="clearer">&nbsp;</div>
				</div>
				<div class="clearer">&nbsp;</div>
			</div>
		</div>


		<!-- This is the delimiter for the menu nav bar, not implementing the sub-nav -->

		<!-- Beginning of the two main columns -->
		<div class="main" id="main-two-columns">
			<!-- MAIN -->
			<div id="page-title">
				<h1>#{trackView.query} - #{trackView.currentSpecies.scientificName}</h1>
				<h:form>
				<p>
				<ui:repeat value="#{trackView.getCurrentPrimaryAccessionsValues()}" var="acc" varStatus="loop">
				    <a href="http://www.uniprot.org/uniprot/#{acc.accession}">#{acc.accession}</a>#{!loop.last ? ', ' : ''}
				</ui:repeat>
				</p>
				</h:form>
			</div>

			<div id="menuBar">
				<h:form>
					<p:menubar toggleEvent="click">
						<p:submenu label="&nbsp; Count History" icon="fa fa-line-chart">
							<p:menuitem value="Direct" actionListener="#{trackView.changeGraph('direct')}" update=":chartForm:chart1" icon="ui-icon-disk" >
							</p:menuitem>
							<p:menuitem value="Propagated"
								actionListener="#{trackView.changeGraph('propagated')}"
								icon="ui-icon-arrowrefresh-1-w" 
								update=":chartForm:chart1"/>
						</p:submenu>
						<p:submenu label="&nbsp; Functionality" icon="fa fa-sitemap">
							<p:menuitem value="Evidence Code History"
								actionListener="#{trackView.keepAlive}" icon="ui-icon-close" />
							<p:menuitem value="GO Term Membership"
								actionListener="#{trackView.keepAlive}" icon="ui-icon-close" />
						</p:submenu>
				        <f:facet name="options">
				        	<p:selectOneMenu id="selectspecies" value="#{indexView.currentSpeciesId}" style="margin-right:5px;">
	        					<p:ajax event="change" update="selectspecies" />
								<f:selectItems value="#{cache.speciesList}" var="spec"
									itemValue="#{spec.id}" itemLabel="#{spec.commonName}" />
							</p:selectOneMenu>
				            <p:autoComplete id="userinp" value="#{indexView.query}" completeMethod="#{indexView.complete}" 
									queryDelay="600" minQueryLength="2" forceSelection="true" maxResults="10"  
									label="ID" emptyMessage="No gene suggestions available,  please try again." style="margin-right:8px;">
									<p:ajax event="focus" update="selectspecies" />
							</p:autoComplete>
				            <p:commandButton type="submit" value="Go" action="#{indexView.go}"/>
				        </f:facet>
					</p:menubar>
				</h:form>
			</div>

			<div class="section">
				<div class="post">
					<div class="post-body">
						<h:form  id="chartForm">
							<p:dialog id="dlg2" header="Annotations" widgetVar="dlg2"
								modal="false" width="700px">
								<h:outputText id="dialogMsg"
									value="Date: #{trackView.selectedDate}, Count: #{fn:length(trackView.terms)}" />
								    <p:dataTable id="dialogAnnotations" widgetVar="annotationsTable" var="term" value="#{trackView.terms}" scrollable="true" scrollHeight="250" sortMode="multiple" style="margin-bottom:0" emptyMessage="No annotations found with given criteria" filteredValue="#{trackView.filteredTerms}">
								        <p:column filterBy="#{term.goId}" filterMatchMode="contains" headerText="Id" style="width:120px;">
								            <a href="http://www.ebi.ac.uk/QuickGO/GTerm?id=#{term.goId}" target="_blank"><i class="fa fa-external-link fa-sm" style="font-size:0.7em;"/> #{term.goId}</a>
								        </p:column>
								        <p:column filterBy="#{term.aspect}" filterMatchMode="in" headerText="Aspect" style="width:200px;">
							                 <f:facet name="filter">
								                <p:selectManyButton onchange="PF('annotationsTable').filter()" panelStyle="width:200px">
								                    <f:selectItem itemLabel="BP" itemValue="BP"/>
								                    <f:selectItem itemLabel="MF" itemValue="MF" />
								                    <f:selectItem itemLabel="CC" itemValue="CC" />
								                </p:selectManyButton>
								            </f:facet>
								            <h:outputText value="Biological Process" rendered="#{term.aspect == 'BP'}"/>
								            <h:outputText value="Molecular Function" rendered="#{term.aspect == 'MF'}"/>
								            <h:outputText value="Cellular Component" rendered="#{term.aspect == 'CC'}"/>
								        </p:column>
								        <p:column filterBy="#{term.name}" filterMatchMode="contains" headerText="Name">
								            <h:outputText value="#{term.name}" />
								        </p:column>
								    </p:dataTable>
							</p:dialog>
							<div id = "allChartsDiv">
							<p:outputPanel id="allCharts">
								<div id="loading-spinner" class="loading"></div>
								<p:chart id='chart1' type="line"
									model="#{trackView.currentChart}" style="height:500px;"
									widgetVar="chart" rendered="#{trackView.chartsReady}">
									<p:ajax event="itemSelect" listener="#{trackView.itemSelect}"
										onsuccess="PF('dlg2').show();"
										update="dialogMsg,dialogAnnotations" />
								</p:chart>
								<p:contextMenu for="chart1">
									<p:menuitem value="&nbsp; Toggle Accessions" actionListener="#{trackView.toggleSplit}" update="chart1" icon="fa fa-bars" />
							    	<p:separator />
							    	<p:menuitem value="&nbsp; Reset" onclick="PF('chart').resetZoom()" icon="fa fa-refresh" />
							    </p:contextMenu>
							</p:outputPanel>
							</div>
							<p:remoteCommand name="fetchCharts"                          
							                  actionListener="#{trackView.fetchDirectChart()}" update="allCharts" oncomplete="loadPropagated(), hideLoadingSpinner()">
							 </p:remoteCommand>
							<p:remoteCommand  actionListener="#{trackView.fetchPropagatedChart()}" name="loadPropagated" >
							 </p:remoteCommand>


							<!-- PUT THE ACTUAL CONTENT -->

							<!-- End of the FUNCTIONALITY CONTENT -->
						</h:form>

					</div>
				</div>
			</div>
			<div class="content-separator"></div>


			<div class="clearer">&nbsp;</div>
			<!-- MAIN -->
		</div>
	</div>

	<!-- This is the end of the two main columns -->

	<div id="footer">
		<div class="center" id="footer-left">
			<p>
				&copy; UBC, Centre of High-throughput Biology, 2014 <a
					href="terms.xhtml">Terms and Conditions</a>
			</p>
		</div>
	</div>
</h:body>
</html>

