<ui:composition template="/WEB-INF/templates/mainLayout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:of="http://omnifaces.org/functions">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam id="query" name="query" value="#{termView.query}" />
			<f:event type="preRenderView" listener="#{termView.init}"/>
		</f:metadata>
	</ui:define>
	<ui:define name="pageTitle">UBC-CHiBi|GOtrack</ui:define>
	<ui:define name="css">
		<h:outputStylesheet library="css" name="term.css" />
	</ui:define>
	<ui:define name="js">
		<h:outputScript library="js" name="utility.js" />
		
			
		<!-- Highcharts stuff -->

		<h:outputScript library="js" name="highcharts.js" />
		<h:outputScript library="js" name="highcharts-more.js" />
		<h:outputScript library="js" name="exporting.js" />
		<h:outputScript library="js" name="export-csv.js" />
		<h:outputScript library="js" name="dagre.min.js" />
		<h:outputScript library="js" name="cytoscape.min.js" />
		
		
		
		
		
		<h:outputScript library="js" name="term.js" />
		
		<h:outputScript rendered="#{termView.trackedTerms != null}">
		$(document).ready(function() {
			$('#loading-spinner').show();
			fetchCharts();
		});
		</h:outputScript>  
	</ui:define>

	<ui:define name="left_right_layout">

		<p:layoutUnit id="left" position="west" size="275" resizable="true"
			collapsible="true" header="Options" minSize="275" collapsed="#{termView.trackedTerms == null}">

			<h:form>
				<h3 class="center">Global Settings</h3>

			</h:form>

			<f:facet name="footer">
				<h:graphicImage library="img" width="130" height="110"
					name="logo1.png" styleClass="center" />
			</f:facet>
		</p:layoutUnit>

	</ui:define>

	<ui:define name="center_layout">
		<p:outputPanel rendered="#{termView.trackedTerms != null}">
				<h:form style="margin:0 25px 0 25px;">
					<p:remoteCommand name="fetchCharts"
						oncomplete="hideLoadingSpinner();handleFetchCharts(xhr, status, args);"
						actionListener="#{termView.fetchCharts()}" />
					<p:remoteCommand name="fetchGraph"
						oncomplete="PF('graphDlgWdg').show();handleFetchGraphDialog(xhr, status, args);"
						actionListener="#{termView.fetchGraph()}" />
					<p:tabView onTabShow="tabShowed(index)">
					<p:tab title="Overview">						
						<p:outputPanel>
							<h3>Current Information</h3>
							<p:panelGrid  styleClass="no-border">
								<p:row>
									<p:column>
										<h:outputText value="ID" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.goId}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Aspect" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.aspect}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Name" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.name}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Obsolete" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.obsolete}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Parents" />
									</p:column>
									<p:column>
										<span class="sqlDialogText"> 
											<ui:repeat
												value="#{termView.currentTerm.parents.toArray()}"
												var="parent" varStatus="loop">
												<p:link value="#{parent.parent.goId}" outcome="trends" target="_blank">
													<f:param name="query" value="#{parent.parent.goId}" />
												</p:link>#{!loop.last ? ', ' : ''}
											</ui:repeat>
										</span>
									</p:column>
								</p:row>

							</p:panelGrid>
                            <h3>Ancestry Chart</h3>
                             <h:panelGrid columns="4" style="margin-bottom:10px" cellpadding="5">
                                 <h:outputText value="Overlay comparison to date: " />
                                 <p:selectOneMenu value="#{termView.compareEditionId}">
                                    <f:selectItems value="#{termView.allGOEditions}" var="ed"
                                        itemValue="#{ed.edition}" itemLabel="#{ed.date}" />
                                </p:selectOneMenu>
                                <p:commandButton value="GO"
                                    actionListener="#{termView.fetchDiff()}" icon="fa fa-bar-chart"
                                    oncomplete="handleFetchDiff(xhr, status, args);" />
                                <p:commandButton type="button" icon="fa fa-trash"                          
                                        onclick="revertOverview()" />
                            </h:panelGrid>
						</p:outputPanel>
						<div id="loading-spinner" class="loading" style="display: none;" />
						<div id="mynetwork" style="height:500px;width:700px;"/>
					</p:tab>
					<p:tab title="Existence">
					<p:outputPanel>
						
						<div id="hc_exist_container" style="width: 100%; height: 600px;"/>

					</p:outputPanel>
					</p:tab>
					<p:tab title="Gene Count">
					
						<div id="hc_gene_container" style="width: 100%; height: 600px;"/>
						
					</p:tab>
					</p:tabView>
						
				</h:form>
		</p:outputPanel>

		<p:outputPanel rendered="#{termView.trackedTerms == null}">
			<h:form>
				<h3 style="text-align: center;">Track a Term</h3>
				<h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" styleClass="termSearchTable">

				<h:outputText value="Enter a GO Term ID or Name: " />
				<p:autoComplete value="#{termSearchView.query}"
					completeMethod="#{termSearchView.complete}" queryDelay="600"
					minQueryLength="2" forceSelection="true" maxResults="10"
					label="ID" panelStyleClass="autocomplete-largepanel"
					emptyMessage="No term suggestions available, please try again."
					var="term" itemLabel="#{term.goId}" itemValue="#{term.goId}">
		            <p:column>
		                <h:outputText value="#{term.goId} - #{term.name}" />
		            </p:column>
		            </p:autoComplete>
				<p:commandButton type="submit" value="Go"
					action="#{termSearchView.go}" />
					</h:panelGrid>
			</h:form>
			
		</p:outputPanel>
		
	</ui:define>
	<ui:define name="dialogs">
		<p:dialog id="graphDlg" header="Ancestor Chart"
			widgetVar="graphDlgWdg" modal="false" showEffect="fade"
			hideEffect="fade" resizable="false" height="600px;" width="800px;">
			<div id="cytoDialog" style="height:500px;width:700px;"/>
		</p:dialog>
	</ui:define>

</ui:composition>