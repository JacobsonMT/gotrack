<ui:composition template="/WEB-INF/templates/mainLayout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:of="http://omnifaces.org/functions">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam id="query" name="query" value="#{termView.query}" />
			<f:event type="preRenderView" listener="#{termView.init}"/>
		</f:metadata>
	</ui:define>
	<ui:define name="pageTitle">UBC-CHiBi|GOtrack</ui:define>
	<ui:define name="css">
		<h:outputStylesheet library="css" name="term.css" />
		<h:outputStylesheet library="css" name="tipsy.css" />
	</ui:define>
	<ui:define name="js">
		<h:outputScript library="js" name="utility.js" />
		
			
		<!-- Highcharts stuff -->

		<h:outputScript library="js" name="highcharts.js" />
		<h:outputScript library="js" name="highcharts-more.js" />
		<h:outputScript library="js" name="exporting.js" />
		<h:outputScript library="js" name="export-csv.js" />
		
		<h:outputScript library="js" name="tipsy.js" />
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <h:outputScript library="js" name="dagre-d3.min.js" />
		

		<h:outputScript library="js" name="term.js" />
		
		<h:outputScript rendered="#{termView.trackedTerms != null}">
		$(document).ready(function() {
			$('.loading').show();
			fetchDAGData();
			fetchEvidenceChart();
			fetchOverviewChart();
			fetchGeneChart();
			
		});
		</h:outputScript>  
	</ui:define>

	<ui:define name="left_right_layout">

	</ui:define>

	<ui:define name="center_layout">
		<p:outputPanel rendered="#{termView.trackedTerms != null}">
				<h:form style="margin:0 25px 0 25px;">
					<p:remoteCommand name="fetchDAGData" async="true"
						oncomplete="handleFetchDAGData(xhr, status, args);"
						actionListener="#{termView.fetchDAGData()}" />
					<p:remoteCommand name="fetchOverviewChart" async="true"
						oncomplete="handleFetchOverviewChart(xhr, status, args);"
						actionListener="#{termView.fetchOverviewChart()}" />
					<p:remoteCommand name="fetchGeneChart" async="true"
						oncomplete="handleFetchGeneChart(xhr, status, args);"
						actionListener="#{termView.fetchGeneChart()}" />
					<p:remoteCommand name="fetchEvidenceChart" async="true"
						oncomplete="handleFetchEvidenceChart(xhr, status, args);"
						actionListener="#{termView.fetchEvidenceChart()}" />
					<p:remoteCommand name="fetchGraph"
						oncomplete="PF('graphDlgWdg').show();handleFetchGraphDialog(xhr, status, args);"
						actionListener="#{termView.fetchGraph()}" />
					<p:tabView onTabShow="tabShowed(index)">
					<p:tab title="Current">						
						<p:outputPanel>
							<h3>Current Information</h3>
							<p:panelGrid  styleClass="no-border">
								<p:row>
									<p:column>
										<h:outputText value="ID" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.goId}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Aspect" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.aspect}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Name" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.name}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Obsolete" />
									</p:column>
									<p:column>
										<h:outputText value="#{termView.currentTerm.obsolete}"
											styleClass="sqlDialogText" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText value="Parents" />
									</p:column>
									<p:column>
										<span class="sqlDialogText"> 
											<ui:repeat
												value="#{termView.currentTerm.parents.toArray()}"
												var="parent" varStatus="loop">
												<p:link value="#{parent.relation.goId}" outcome="trends" target="_blank">
													<f:param name="query" value="#{parent.relation.goId}" />
												</p:link>#{!loop.last ? ', ' : ''}
											</ui:repeat>
										</span>
									</p:column>
								</p:row>
								
								<p:row>
									<p:column>
										<h:outputText value="Children" />
									</p:column>
									<p:column>
										<span class="sqlDialogText"> 
											<ui:repeat
												value="#{termView.currentTerm.children.toArray()}"
												var="children" varStatus="loop">
												<p:link value="#{children.relation.goId}" outcome="trends" target="_blank">
													<f:param name="query" value="#{children.relation.goId}" />
												</p:link>#{!loop.last ? ', ' : ''}
											</ui:repeat>
										</span>
									</p:column>
								</p:row>

							</p:panelGrid>
                            <h3>Ancestry Chart</h3>
						</p:outputPanel>
						<div id="loading-spinner-DAG" class="loading" style="display: none;" />
						<svg id="currentAncestry" width="900" height="600"/>
					</p:tab>
					<p:tab title="Overview">
					<p:outputPanel>
						<div id="loading-spinner-overview" class="loading" style="display: none;" />
						<div id="hc_overview_container" style="width: 100%; height: 600px;"/>

					</p:outputPanel>
					</p:tab>
					<p:tab title="Gene Breakdown">
					    <div id="loading-spinner-gene" class="loading" style="display: none;" />
						<div id="hc_gene_container" style="width: 100%; height: 600px;"/>
						
					</p:tab>
					<p:tab title="Evidence Breakdown">
						<div id="loading-spinner-evidence" class="loading" style="display: none;" />
						<div id="hc_evidence_container" style="width: 100%; height: 600px;"/>
						
					</p:tab>
					</p:tabView>
						
				</h:form>
		</p:outputPanel>

		<p:outputPanel rendered="#{termView.trackedTerms == null}">
			<h:form>
				<h3 style="text-align: center;">Track a Term</h3>
				<h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" styleClass="termSearchTable">

				<h:outputText value="Enter a GO Term ID or Name: " />
				<p:autoComplete value="#{termSearchView.query}"
					completeMethod="#{termSearchView.complete}" queryDelay="600"
					minQueryLength="2" forceSelection="true" maxResults="10"
					label="ID" panelStyleClass="autocomplete-largepanel"
					emptyMessage="No term suggestions available, please try again."
					var="term" itemLabel="#{term.goId}" itemValue="#{term.goId}">
		            <p:column>
		                <h:outputText value="#{term.goId} - #{term.name}" />
		            </p:column>
		            </p:autoComplete>
				<p:commandButton type="submit" value="Go"
					action="#{termSearchView.go}" />
					</h:panelGrid>
			</h:form>
			
		</p:outputPanel>
		
	</ui:define>
	<ui:define name="dialogs">
		<p:dialog id="graphDlg" header="Ancestor Chart"
			widgetVar="graphDlgWdg" modal="false" showEffect="fade"
			hideEffect="fade" resizable="false" height="600px;" width="800px;">
			<svg id="dagDialog" height="500" width="700"/>
		</p:dialog>
	</ui:define>

</ui:composition>